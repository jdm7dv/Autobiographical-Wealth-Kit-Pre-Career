// Max External: tap.random.c// T.Place - (11/30/2001)// A simple Max object to step through random numbers.#include "ext.h"				// Required for all Max external objects#include <time.h>			// Used for seeding#include "ext_strings.h"		// Used for the assistance stringsvoid *this_class;			// Required. Global pointing to this class typedef struct taprandom		// Data structure for this object {	Object p_ob;			// Must always be the first field; used by Max 	float p_value;			// Value from which to determine next taprandom number	void *p_out;			// Pointer to outlet. need one for each outlet } TAPtaprandom;		// Prototypes for methods: need a method for each incoming messagevoid *taprandom_new(void);												// object creation method  void *taprandom_bang(TAPtaprandom *taprandom);								// method for "bang" message void *taprandom_int(TAPtaprandom *taprandom, long value);						// method for int inputvoid taprandom_assist(TAPtaprandom *taprandom, void *b, long m, long a, char *s); 	// assistance messagesvoid random_free(TAPtaprandom *taprandom);/*********************************************************///Main() Functionvoid main(void)			//main receives a copy of the Max function macros table {		setup((t_messlist **)&this_class, (method)taprandom_new, (method)random_free, (short)sizeof(TAPtaprandom), 0L, 0);	addbang((method)taprandom_bang); 							// bind method "bang_bang" to the "bang" message	addint((method)taprandom_bang);							// bind method "int_int" to the int input (L inlet)	addfloat((method)taprandom_bang);	addmess((method)taprandom_bang, "anything", 0); 				// bind method "bang_bang" to the "bang" message	addmess((method)taprandom_assist, "assist", A_CANT, 0);		// Bind method "taprandom_assist" to assistance calls	addmess((method)inspector_open, "info", A_CANT, 0);	post("tap.random v1.0 - Copyright © 2001 by Timothy A. Place");	// Print to the Max Window...	post("     Impact Center @ University of Missouri - Kansas City / Silicon Prairie Intermedia");}/*********************************************************///Object Creation Functionvoid *taprandom_new(void){	TAPtaprandom *taprandom;	taprandom = (TAPtaprandom *)newobject(this_class);	// create the new instance and return a pointer to it 	taprandom->p_out = floatout(taprandom);			// Create the outlet	return(taprandom);								// must return a pointer to the new instance }/*********************************************************///Bound to inlet Functions// Method for Assistance Messagesvoid taprandom_assist(TAPtaprandom *taprandom, void *b, long msg, long arg, char *dst){	if(msg==1) 	// Inlets		strcpy(dst, "(bang) Generate a random number");	else if(msg==2) // Outlets		strcpy(dst, "(float) Random number");}// BANG in left inletvoid *taprandom_bang(TAPtaprandom *taprandom){	unsigned long randx = clock();	int i = ((randx = randx*1103515245 + 12345)>>16) & 077777;	taprandom->p_value = (float)i/16384. - 1.;	outlet_float(taprandom->p_out, taprandom->p_value);		// output the result}// free methodvoid random_free(TAPtaprandom *taprandom){	notify_free((t_object *)taprandom);}